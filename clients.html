<div x-data="clientManager" class="relative w-full">
  <div>
    <div class="mb-4 flex justify-between align-middle">
      <!-- Style Search Input -->
      <div class="transition-all duration-500">
        <input
          type="text"
          placeholder="Search Clients..."
          class="srch-style transition-all duration-500"
          x-model="clientSearch"
          @input="searchClients"
          x-transition
        />
      </div>
      <!-- CLIENTS CENTER TEXT -->
      <div class="flex justify-center">
        <h2
          class="text- cursor-default self-center text-3xl font-semibold tracking-wider text-vdark-700 underline decoration-vred-400 decoration-4 underline-offset-2 dark:text-neutral-300 dark:decoration-neutral-300"
        >
          Clients
        </h2>
      </div>
      <button
        @click="showAddClientModal = true; 
        if(showAddClientModal) $nextTick(() => $refs.addNewClientName.focus())"
        @keydown.escape.window="showAddClientModal = false"
        class="butt-style"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 23 23"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-user-plus mr-2"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="8.5" cy="7" r="4"></circle>
          <line x1="20" y1="8" x2="20" y2="14"></line>
          <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
        Add Client
      </button>
    </div>
  </div>
  <div class="flex justify-center">
    <!-- Clients Table -->
    <table class="w-full border-separate text-vwhite-50" style="border-spacing: 0 10px">
      <thead class="rounded bg-vdark-600 text-base font-medium text-vwhite-50 dark:bg-zinc-900 dark:text-neutral-300">
        <tr>
          <th class="max-w-1/12 hidden">ID</th>
          <th id="sortNameClients" class="max-w-2/12 round-left-border p-4 pl-4 text-left text-lg">Name</th>
          <th class="max-w-2/12 p-4 text-left text-base">Company Name</th>
          <th class="max-w-2/12 p-4 text-left text-base">Address</th>
          <th class="max-w-2/12 p-4 text-left text-base">Email</th>
          <th class="max-w-2/12 round-right-border p-4 pr-4 text-left text-base">Actions</th>
        </tr>
      </thead>
      <tbody class="bg-slate-600 text-vwhite-50 dark:bg-neutral-700">
        <template x-for="client in filteredClients" :key="client.id">
          <tr
            class="cursor-default transition duration-200 hover:bg-slate-500 dark:hover:bg-neutral-600 dark:hover:text-white"
          >
            <td class="hidden" x-text="client.id"></td>
            <td class="round-left-border p-2 text-sm">
              <template x-if="client.isEditing">
                <input type="text" x-model="client.name" class="table-edit-input-style" />
              </template>
              <template x-if="!client.isEditing">
                <span x-text="client.name" class="mr-6"></span>
              </template>
            </td>
            <td class="p-2 text-sm">
              <template x-if="client.isEditing">
                <input type="text" x-model="client.company_name" class="table-edit-input-style" />
              </template>
              <template x-if="!client.isEditing">
                <span x-text="client.company_name" class="mr-6"></span>
              </template>
            </td>
            <td class="p-2 text-sm">
              <template x-if="client.isEditing">
                <input type="text" x-model="client.address" class="table-edit-input-style" />
              </template>
              <template x-if="!client.isEditing">
                <span x-text="client.address" class="mr-6"></span>
              </template>
            </td>
            <td class="p-2 text-sm">
              <template x-if="client.isEditing">
                <input type="text" x-model="client.email" class="table-edit-input-style" />
              </template>
              <template x-if="!client.isEditing">
                <span x-text="client.email" class="mr-6"></span>
              </template>
            </td>
            <td class="round-right-border text-center text-sm">
              <template x-if="client.isEditing">
                <div>
                  <button
                    @click="saveClient(client)"
                    class="p-1 text-sm text-slate-100 transition duration-300 hover:text-blue-400"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="feather feather-save"
                    >
                      <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                      <polyline points="17 21 17 13 7 13 7 21"></polyline>
                      <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                  </button>
                  <button
                    @click="cancelEdit(client)"
                    class="p-1 text-sm text-slate-100 transition duration-300 hover:text-red-400"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="feather feather-x-circle"
                    >
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="15" y1="9" x2="9" y2="15"></line>
                      <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                  </button>
                </div>
              </template>
              <template x-if="!client.isEditing">
                <div class="">
                  <button
                    @click="editClient(client)"
                    class="p-1 text-sm text-slate-100 transition duration-300 hover:text-blue-400"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="feather feather-edit-2"
                    >
                      <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                    </svg>
                  </button>
                  <button
                    @click="removeClient(client.id)"
                    class="p-1 text-sm text-slate-100 transition duration-300 hover:text-red-400"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      class="feather feather-trash-2"
                    >
                      <polyline points="3 6 5 6 21 6"></polyline>
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
                </div>
              </template>
            </td>
          </tr>
        </template>
      </tbody>
    </table>
  </div>
  <!-- MARK: ADD CLIENT -->
  <div
    x-show="showAddClientModal"
    x-transition.opacity.duration.300
    class="fixed inset-0 z-50 h-full w-full overflow-y-auto bg-gray-800 bg-opacity-50"
    id="my-modal"
  >
    <!-- Modal content -->
    <div
      class="relative top-1/4 mx-auto w-96 rounded-md border border-slate-300 bg-vdark-600 text-center text-vwhite-50 shadow-lg dark:bg-zinc-900 dark:text-neutral-300"
    >
      <div @click.outside="showAddClientModal = false">
        <div class="p-6">
          <h3 class="mb-4 text-xl font-medium">Add Client</h3>
          <form @submit.prevent="addClient">
            <input
              x-model="newClient.name"
              x-ref="addNewClientName"
              name="name"
              type="text"
              placeholder="Name"
              class="modal-input-style mb-2 w-full"
              required
            />
            <input
              x-model="newClient.company_name"
              name="company_name"
              type="text"
              placeholder="Company Name"
              class="modal-input-style mb-2 w-full"
              required
            />
            <input
              x-model="newClient.address"
              name="address"
              type="text"
              placeholder="Address"
              class="modal-input-style mb-2 w-full"
              required
            />
            <input
              x-model="newClient.email"
              name="email"
              type="email"
              placeholder="Email"
              class="modal-input-style mb-2 w-full"
              required
            />
            <button
              type="submit"
              class="close-modal-button submit-button w-full rounded-md bg-sky-700 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-sky-800 focus:outline-none focus:ring-2 focus:ring-sky-600"
            >
              Add
            </button>
          </form>
          <div class="mt-2 items-center">
            <button
              @click="showAddClientModal = false"
              class="close-modal-button submit-button w-full rounded-md bg-red-800 p-1 text-base font-medium text-slate-100 shadow-sm transition-colors duration-200 hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-red-500"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
